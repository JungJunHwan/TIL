# DNS 리졸빙 과정

`www.google.com`을 `142.250.196.110`으로 변환하는 과정

## 1. 로컬 캐시 확인 (Browser & OS Cache)

가장 먼저 내 컴퓨터 안에서 답을 찾는다. 이전에 방문했던 사이트라면 굳이 인터넷 망으로 나갈 필요가 없기 때문

- 브라우저 캐시
    - 크롬이나 엣지 같은 브라우저가 최근에 방문한 사이트의 IP를 기억하는지 확인
- OS 캐시
    - 브라우저에 없다면 운영체제의 DNS 캐시나 `hosts` 파일을 확인

## 2. 통신망 등 캐시 확인 (Recursive Resolver / ISP DNS)

내 컴퓨터에 정보가 없다면, 가입한 통신사의 LNDS(Local DNS 서버) 혹은 설정해둔 공개 DNS(Google 8.8.8.8 등) 에게 물어보는데 이를 Recursive Resolver라고 한다

- 이 서버도 수많은 사용자가 요청한 정보를 캐시로 들고 있는데, 여기에 정보가 있다면 바로 응답해주고 과정이 끝난다

## 3. 루트 기관에 어디서 확인해야 하는지 물어봄 (Root Name Server)

통신사 서버에도 정보가 없다면, 계층 구조를 따라가며 물어보는데, 첫 번째 관문이 루트 서버이다

- 루트 서버는 전 세계에 몇 대 없는 최상위 서버
- 루트 서버는 직접적인 IP 주소는 모르지만, 주소의 끝부분(`.com`, `.net` 등)을 보고 어느 TLD(Top-Level Domain) 서버로 가야하는지 알려줌

### 루트 서버의 역할과 특징

1. 나는 모르지만, 누구에게 물어볼지는 알아
    - 루트 서버는 특정 사이트의 실제 IP 주소를 가지고 있지 않지만, 도메인의 가장 오른쪽 끝에 붙는 TDL(Top-Level Domain) 서버가 어디에 있는지 알려준다
    - 사용자가 `www.naver.com`을 찾는다면 루트 서버는 `.com` 서버 목록을 준다
2. 13개의 논리적 주소 (A ~ M)
    - 전 세계적으로 루트 서버는 13개의 대표 IP 주소를 가진다
    - 이를 `a.root-servers.net`부터 `m.root-servers.net`까지 이름 붙여 관리한다
    - 왜 13개냐면 초기 네트워크 프로토콜(UDP)의 패킷 크기 제한 때문에 응답 효율을 높이기 위해 정해진 숫자이다
    - 실제 물리적인 서버 대수가 13대라는 뜻은 아니다
        - Anycast라는 기술을 사용해 전 세계 수천 곳의 데이터 센터에 복제본이 흩어져 있다
        - 한국에서 접속하면 한국이나 일본 등 가장 가까운 곳의 루트 서버가 응답한다
3. DNS 계층 구조의 뿌리
    - 우리가 보통 `google.com`이라고 쓰지만, 실제 전체 이름(FQDN, Fully Qualified Domain Name)은 `google.com.`이다
    - 마지막에 찍히는 보이지 않는 `.`이 바로 루트를 의미한다
    - 루트 서버는 이 `.` 영역을 관리하며, 하위 도메인 관리 권한을 위임하는 역할을 수행한다
4. 누가 관리하나
    - 루트 서버의 운영은 전 세계의 다양한 기관이 나누어서 맡고 있다
        - ICANN(IANA) : 전체적인 관리를 주관
        - 미국 국방부, NASA, 대학교, 민간 기업 : 각기 다른 루트 서버 주소를 운영해 특정 국가나 기업이 인터넷 전체를 독점하거나 마비시키지 못하도록 분산됨


## 4. 해당 DNS에 확인 요청 (TLD & Authoritative DNS)

루트 서버가 알려준 길을 따라 차례대로 물어본다

- TLD 서버
    - `.com` 서버에 가서 "https://www.google.com/search?q=google.com 어디 있어?"라고 물으면, 해당 도메인을 관리하는 네임 서버(Authoritative DNS) 주소를 알려줌
- 권한 있는 네임 서버 (Authoritative DNS)
    - 실제로 도메인 정보가 등록된 최종 목적지
    - 여기서 `www.google.com`의 진짜 IP 주소를 받아오게 된다

### TLD & Authoritative DNS의 특징

- TLD(Top-Level Domain) 서버 : 중간 관리자
    - 루트 서버가 가라고 지목한 곳이며, 도메인의 가장 마지막 부분(`.com`, `.net` 등)을 담당한다
    - 분류
        - gTLD(generic TLD)
            - `.com`, `.org`처럼 일반적인 목적으로 사용되는 도메인
            - 주로 Verisign 같은 글로벌 기업이 관리
        - ccTLD(country code TLD)
            - `.kr`, `.jp`, .`.us`처럼 국가별로 할당된 도메인
            - 한국의 경우 KISA(한국 인터넷 진흥원)가 관리
    - 역할
        - TLD 서버는 해당 도메인이 등록된 진짜 주소판이 어디에 있는지 알고 있다
        - 예를 들어, `naver.com`을 찾는다면 `.com` TLD 서버는 네이버의 주소 정보는 가비아 또는 네이버 자체 서버에 등록되어 있으니 거기로 가보라며 Authoritative Name Server 주소를 알려준다
- Authoritative Name Server : 최종 목적지
    - 실제 IP 주소를 가지고 있는 서버
        - 역할
            - 특정 도메인 이름에 대한 최종 권한을 가진 서버
            - `www.naver.com`의 IP가 `223.130.195.200`이라는 사실을 확실히 답변해 줄 수 있는 유일한 곳
        - 관리 주체
            - 구글이나 네이버처럼 큰 기업은 직접 이 서버를 운영
            - 개인이나 중소기업은 도메인 등록 업체(AWS Route53, 가비아 등)가 제공하는 네임 서버를 대여해서 사용
        - 답변 내용
            - 단순히 IP 주소(A 레코드)뿐만 아니라, 메일 서버 주소(MX 레코드), 별칭(CNAME) 등 도메인에 관련된 모든 상세 설정을 제공

## 5. 캐시에 IP 저장

- 통신사 DNS와 내 컴퓨터는 이 IP 주소를 일정 시간동안 캐싱한다
- 이렇게 저장해두면 다음에 접속할 때 3~4번 과정을 생략하고 1~2번 단계에서 바로 접속할 수 있어 속도가 매우 빨라진다